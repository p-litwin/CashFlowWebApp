{% extends "authorized.html" %}

{% block title %}CashFlowApp - Lista transakcji{% endblock %}

{% block footer %}
<script type="text/javascript" src="/js/addIncomeForm.js"></script>
<script type="text/javascript" src="/js/addExpenseForm.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
{% endblock %}

{% block body %}

<div class="container-fluid main-content">
  <div class="row site-title">
    <h1>Lista transakcji</h1>
  </div>
  <!-- Transactions list -->
  {% if transactions %}
        {% set previous = false %}      
        {% for transaction in transactions %}
          {% if previous == false  %}
            <div class="date-container">
              <p class="transaction-date">{{transaction.date}}</p>
              <hr>
            </div>
            {% set previous = transaction %}
          {% else %}
            {% if transaction.date == previous.date %}
            {% else %}
            <div class="date-container">
              <p class="transaction-date">{{transaction.date}}</p>
              <hr>
            </div>
            {% set previous = transaction %}
            {% endif %}
          {% endif %}
        <div class="card shadow-sm mb-1">
          <div class="card-body ps-2 pt-2 pb-2 pe-2 transaction-details d-flex justify-content-between">
            <div class="col-lg-10 col-md-10 col-sm-10 col-7">
              <div class="row">
              <div class="col-sm-6 col-12 no-wrap-text transaction-category" title="{{transaction.name}}">{{transaction.name}}</div>
              {% if transaction.comment is empty %}
                <div class="col-sm-6 col-12 no-wrap-text text-body-secondary" title="Brak opisu">(Brak opisu)</div>
              {% else %}
                <div class="col-sm-6 col-12 no-wrap-text transaction-comment" title="{{transaction.comment}}">{{transaction.comment}}</div>
              {% endif %}
              </div>
            </div>
            <div class="col-lg-2 col-md-2 col-sm-2 col-5 justify-content-end">
              <div class="row ps-4 pe-3 h-100">  
                <div class="col-11 amount {{transaction.type}}-amount">{{transaction.amount}} zł</div>
                <div class="col-1 ps-0 pe-0 transaction-ellipsis text-end">
                  <div class="dropdown">
                    <a class="" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      <i class="fa-solid fa-ellipsis-vertical"></i>
                    </a>
                    <ul class="dropdown-menu ellipsis-menu">
                      <li><button class="btn btn-block" href="/transactions-list/delete" data-bs-toggle="modal" data-bs-target="#transactionDeleteModal" data-bs-id="{{transaction.transaction_id}}" data-bs-type="{{transaction.type}}">
                        <i class="fa-solid fa-trash-can" style="color: #f00006;"></i> Delete</button></li>
                        <li><button class="btn btn-block transaction-form-button" data-bs-action="update" data-bs-id="{{transaction.transaction_id}}" data-bs-toggle="modal" data-bs-target="#{{transaction.type}}EditModal" data-bs-amount="{{transaction.amount}}" data-bs-category="{{transaction.category_id}}" data-bs-payment="{{transaction.payment_method}}" data-bs-date="{{transaction.date}}" data-bs-comment="{{transaction.comment}}"><i class="fa-solid fa-pen-to-square"></i> Edit</button></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
  {% else %}
  No transactions to show
  {% endif %}
<!-- Transactions list end -->
<!-- Pagination -->
  <nav class="mt-4">
    <ul class="pagination justify-content-center">
      {% if page == 1 %}
        <li class="page-item page-link"><i class="fa-solid fa-angles-left" style="color: #c0c0c0;"></i></li>
      {% else %}
        <li class="page-item"><a class="page-link" sr-only="Pierwsza strona" title="Pierwsza strona" href="/transactions-list/show/1"><i class="fa-solid fa-angles-left"></i></a></li>
      {% endif %}
      {% if page == 1 %}
        <li class="page-item page-link"><i class="fa-solid fa-angle-left" style="color: #c0c0c0;"></i></li>
      {% else %}
        <li class="page-item"><a class="page-link" sr-only="Poprzednia strona" title="Poprzednia strona" href="/transactions-list/show/{{previous_page}}"><i class="fa-solid fa-angle-left"></i></a></li>
      {% endif %}
      <li class="page-item"><span class="page-link">Strona {{page}} z {{last_page}}</span></li>
      {% if page >= last_page %}
        <li class="page-item page-link"><i class="fa-solid fa-angle-right" style="color: #c0c0c0;" ></i></li>
      {% else %}
        <li class="page-item"><a class="page-link" sr-only="Następna strona" title="Następna strona" href="/transactions-list/show/{{next_page}}"><i class="fa-solid fa-angle-right"></i></a></li>
      {% endif %}
      {% if page == last_page %}
        <li class="page-item page-link"><i class="fa-solid fa-angles-right" style="color: #c0c0c0;" ></i></li>
      {% else %}
        <li class="page-item"><a class="page-link" sr-only="Ostatnia strona" title="Ostatnia strona" href="/transactions-list/show/{{last_page}}"><i class="fa-solid fa-angles-right"></i></a></li>
      {% endif %}
    </ul>
  </nav>
<!-- Pagination end -->
</div>
{% endblock %}